<header>
  <img src="assets/logo.svg" alt="Logo" />
  <h1>2025ASDDAGUI</h1>
</header>
<div class="container">
  <h2>{{ title }}</h2>

  <!-- Toggle between Edit and Use modes -->
  <button class="btn mb-2 btn-primary" (click)="toggleMode()">
    Switch to {{ mode === 'edit' ? 'Use' : 'Edit' }} Mode
  </button>
  <div *ngIf="mode ==='edit'">
    <!-- Save/Load Controls -->
    <button class="btn mb-2 btn-secondary" (click)="saveDAG()">Save Locally</button>
    <button class="btn mb-2 btn-secondary" (click)="loadDAG()">Load Locally</button>
    <button class="btn mb-2 btn-secondary" (click)="exportAsJSON()">Export as JSON</button>
    <button class="btn mb-2 btn-secondary" (click)="exportAsCSV()">Export as CSV</button>

    <!-- CSV Import (only in Edit mode) -->
    <button class="btn mb-2 btn-secondary" (click)="exportAsJSON()" class="btn btn-primary">Export as JSON</button>
    <input type="file" accept=".json" (change)="importJSON($event)" class="form-control-file" />

    <!-- CSV Export / Import -->
    <button class="btn mb-2 btn-secondary" (click)="exportAsCSV()" class="btn btn-secondary">Export as CSV</button>
    <input type="file" accept=".csv" (change)="importCSV($event)" class="form-control-file" />
  </div>
  <!-- Edit Mode: Builder View -->
  <div *ngIf="mode === 'edit'">
    <button class="btn btn-secondary" (click)="addRootNode()">Add Root Node</button>
    <div class="builder-view">
      <ng-container *ngFor="let node of getRootNodes()">
        <app-node 
          [node]="node" 
          [allNodes]="nodes"
          [editMode]="true"
          (addChild)="addChildNode($event)" 
          (remove)="removeNode($event)">
        </app-node>
      </ng-container>
    </div>
  </div>

  <!-- Use Mode: Usability View -->
  <div *ngIf="mode === 'use'">
    <div class="use-header">
      <h2>Sentence: {{ getSentence() }}</h2>
      <button class="btn btn-warning" (click)="goBack()" [disabled]="currentPath.length === 0">Back</button>
      <button class="btn btn-danger" (click)="speakSentence()">Speak Sentence</button>
    </div>
    <div class="grid-container">
      <div class="grid-item"
           *ngFor="let cell of getGridCells()"
           (click)="cell ? onUseNodeClick(cell) : null"
           [ngClass]="{'empty': !cell}">
        <ng-container *ngIf="cell; else emptyCell">
          <img [src]="cell.imageUrl" alt="{{ cell.text }}" />
          <div>{{ cell.text }}</div>
        </ng-container>
        <ng-template #emptyCell>
          <div class="empty-label">Empty</div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
